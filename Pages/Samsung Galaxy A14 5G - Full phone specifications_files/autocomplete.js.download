function Autocomplete(e,t,s,i,o){function n(e,t){for(;t!=e&&null!=e;)e=e.parentNode;return t==e}if(this.field=document.getElementById(e),this.wrapper=document.getElementById(t)||document.querySelector(t),this.full=s,this.hideImages=!!o,i)this.position=i;else{var a=t.match(/\d$/);this.position=a?a[0]:""}this.div=$gsm.tag("div",{class:"autocomplete autocomplete-search autocomplete-small autocomplete-hide"},"",this.wrapper),this.parent=this.div,this.reviewsDiv=$gsm.tag("div",{class:"reviews-results float-left"},"",this.div),$gsm.tag("span",{class:"autocomplete-desc"},"Reviews",this.reviewsDiv),this.reviewsList=$gsm.tag("ul",{},"",this.reviewsDiv);var h=$gsm.tag("li",{class:"permanent"},"",this.reviewsList);this.reviewsMore=$gsm.tag("a",{class:"more-news-link more-news-link-small",href:"#"},"More review results",h),this.phonesDiv=$gsm.tag("div",{class:"phone-results"},"",this.div),this.phoneLabel=$gsm.tag("span",{class:"autocomplete-desc"},"Last visited",this.phonesDiv),this.phonesList=$gsm.tag("ul",{class:"autocomplete-last-searched"},"",this.phonesDiv),this.phonesMoreLi=$gsm.tag("li",{class:"permanent",style:"display: none;"},"",this.phonesList),this.phonesMore=$gsm.tag("a",{class:"more-news-link more-news-link-small",href:"#"},"More device results",this.phonesMoreLi),this.newsDiv=$gsm.tag("div",{class:"news-results float-left"},"",this.div),$gsm.tag("span",{class:"autocomplete-desc"},"News",this.newsDiv),this.newsList=$gsm.tag("ul",{},"",this.newsDiv);var l=$gsm.tag("li",{class:"permanent"},"",this.newsList);this.newsMore=$gsm.tag("a",{class:"more-news-link more-news-link-small",href:"#"},"More news results",l);var r=this.field.parentNode;this.position||(this.searchButtons=$gsm.tag("div",{class:"search-buttons"},"",r),this.goButton=$gsm.tag("a",{class:"go",href:"#"},"Go",this.searchButtons),this.advancedButton=$gsm.tag("a",{class:"advanced",href:"search.php3"},"Advanced",this.searchButtons)),i||(this.quickSearchButton=document.querySelector("#quick-search-button")),this.loadRecentPhones();var E=this;$gsm.addEventListener(document,"click",function(e){n(e.target,E.parent)||E.hide()},!0),$gsm.addEventListener(document,"touchend",function(e){n(e.target,E.parent)||$gsm.hasClass(E.div,"autocomplete-hide")||E.hide()},!0),this.field.onclick=function(){AUTOCOMPLETE_LIST?E.searchPhones():E.loadList(),E.searchButtons&&(E.searchButtons.style.display="initial"),E.position||(E.quickSearchButton.style.display="none")},this.field.onkeyup=function(e){var t=E.field.value,s=E.div.querySelector(".autocomplete-selected");if(s&&$gsm.removeClass(s,"autocomplete-selected"),e.which!=KEY_DOWN_ARROW)if(e.which!=KEY_UP_ARROW){if(e.which==KEY_LEFT_ARROW||e.which==KEY_RIGHT_ARROW){if(!E.full)return;if(!s)return;if(0==t.length)return void $gsm.addClass(s,"autocomplete-selected");for(var i=[E.reviewsList,E.phonesList,E.newsList],o=s.parentNode.parentNode,n=0;n<o.childElementCount&&o.children[n].firstChild!=s;n++);var a=e.which==KEY_LEFT_ARROW?-1:1,h=i.indexOf(o);do{h=(i.length+h+a)%i.length}while(0==i[h].childElementCount);return n=Math.min(n,i[h].childElementCount-1),void $gsm.addClass(i[h].children[n].firstChild,"autocomplete-selected")}e.which!=KEY_ESCAPE?t.length>=1?(E.setList(E.phonesList,[]),E.searchPhones(),E.searchNewsAndReviews()):E.showRecentPhones():E.hide()}else if(s){var l=s.parentNode.previousSibling;l||(l=s.parentNode.parentNode.lastChild),$gsm.addClass(l.firstChild,"autocomplete-selected")}else $gsm.addClass(E.phonesMore,"autocomplete-selected");else if(s){var r=s.parentNode.nextSibling;r||(r=s.parentNode.parentNode.firstChild),$gsm.addClass(r.firstChild,"autocomplete-selected")}else E.phonesList.firstChild&&$gsm.addClass(E.phonesList.firstChild.firstChild,"autocomplete-selected")},this.field.onkeydown=function(e){var t=E.div.querySelector(".autocomplete-selected");if(e.which==KEY_ENTER){if(t)return e.preventDefault(),e.stopPropagation(),"#"==t.getAttribute("href")?void t.onclick(e):void(window.location=t.href);if(this.value.length<AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH)return e.preventDefault(),void e.stopPropagation()}},this.phonesMore.onclick=function(e){e.preventDefault(),e.stopPropagation();for(var t=E.field.parentNode;"FORM"!=t.nodeName;)t=t.parentNode;t.submit()},this.goButton&&(this.goButton.onclick=this.phonesMore.onclick),this.newsMore.onclick=function(e){e.preventDefault(),e.stopPropagation(),window.location="news.php3?sSearch="+E.field.value},this.reviewsMore.onclick=function(e){e.preventDefault(),e.stopPropagation(),window.location="reviews.php3?sSearch="+E.field.value},document.activeElement!=this.field&&""===this.field.value||""===this.field.getAttribute("value")&&(this.loadList(),this.searchNewsAndReviews())}"undefined"==typeof AUTOCOMPLETE_MAX_LINES&&(AUTOCOMPLETE_MAX_LINES=5),"undefined"==typeof AUTOCOMPLETE_NEWS_REVIEWS_TIMEOUT&&(AUTOCOMPLETE_NEWS_REVIEWS_TIMEOUT=1e3),"undefined"==typeof AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH&&(AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH=2),"undefined"==typeof AUTOCOMPLETE_THUMB_URL&&(AUTOCOMPLETE_THUMB_URL=CDN2_BASE_URL+"vv/bigpic/"),"undefined"==typeof NEWS_REVIEWS_URL&&(NEWS_REVIEWS_URL="search-json.php3"),"undefined"==typeof AUTOCOMPLETE_RECENT_URL&&(AUTOCOMPLETE_RECENT_URL="history-json.php3"),AUTOCOMPLETE_MAKERS=null,AUTOCOMPLETE_LIST=null,AUTOCOMPLETE_RECENT=[];var KEY_LEFT_ARROW=37,KEY_RIGHT_ARROW=39,KEY_UP_ARROW=38,KEY_DOWN_ARROW=40,KEY_BACKSPACE=8,KEY_ESCAPE=27,KEY_ENTER=13,AUTOCOMPLETE_MAKERID=0,AUTOCOMPLETE_PHONEID=1,AUTOCOMPLETE_PHONE_NAME=2,AUTOCOMPLETE_SEARCH_STR=3,AUTOCOMPLETE_THUMB=4;Autocomplete.prototype.loadList=function(){if(null===AUTOCOMPLETE_LIST){AUTOCOMPLETE_LIST=!1;var e=this;$gsm.xhr("GET",AUTOCOMPLETE_LIST_URL,function(t){AUTOCOMPLETE_MAKERS=t[0],AUTOCOMPLETE_LIST=t[1],window.location.search.match(new RegExp("sSearch"+this.position+"="))||e.searchPhones()}),""===this.field.value&&this.showRecentPhones()}},Autocomplete.prototype.loadRecentPhones=function(){var e=localStorage.getItem("recentPhones");if(e=e?JSON.parse(e):[],"undefined"!=typeof HISTORY_ITEM_URL){for(var t={href:HISTORY_ITEM_URL,src:HISTORY_ITEM_IMAGE,text:HISTORY_ITEM_NAME,id:HISTORY_ITEM_ID},s=0;s<e.length;)e[s].id==t.id||e[s].href==t.href?e.splice(s,1):s++;e.unshift(t),e.splice(AUTOCOMPLETE_MAX_LINES),localStorage.setItem("recentPhones",JSON.stringify(e))}AUTOCOMPLETE_RECENT=e},Autocomplete.prototype.setList=function(e,t){for(var s=0;s<e.childElementCount;){var i=e.children[s];$gsm.hasClass(i,"permanent")?s++:e.removeChild(i)}for(s=t.length-1;s>=0;s--){var o=document.createElement("li");e.insertBefore(o,e.firstChild);var n=$gsm.tag("a",{href:t[s].href},"",o);$gsm.tag("img",{src:this.hideImages?"":t[s].src},"",n),$gsm.tag("span",{},t[s].text,n)}},Autocomplete.prototype.makePhone=function(e){function t(e){if(e.href)return e.href;var t=AUTOCOMPLETE_MAKERS[e[AUTOCOMPLETE_MAKERID]]+" ";return t+=e[AUTOCOMPLETE_PHONE_NAME],t=t.toLowerCase().replace(/\s+|-|\/|\./g,"_"),t+="-"+e[AUTOCOMPLETE_PHONEID]+".php",t}function s(e){var t=window.location.search;return t||(t="?"),t=t.replace(new RegExp("&?idPhone"+i.position+"=\\d+"),""),"?"!=t.charAt(t.length-1)&&(t+="&"),t+="idPhone"+i.position+"=",t+=e.id||e[AUTOCOMPLETE_PHONEID],window.location.pathname+t+window.location.hash}var i=this;return{href:this.full?t(e):s(e),src:e.src||AUTOCOMPLETE_THUMB_URL+e[AUTOCOMPLETE_THUMB],text:e.text||AUTOCOMPLETE_MAKERS[e[AUTOCOMPLETE_MAKERID]]+" "+e[AUTOCOMPLETE_PHONE_NAME]}},Autocomplete.prototype.searchPhones=function(){function e(e){return e.replace(/^\s*(.*?)\s*$/,"$1")}function t(e,t,s){for(var i=0;i<e.length;i++)if(!t.match(new RegExp("\\b"+e[i]+(s?"\\b":""))))return!1;return!0}var s=e(this.field.value).toLowerCase();if(0!=s.length){if(AUTOCOMPLETE_LIST){this.phoneLabel.innerHTML="Devices",$gsm.removeClass(this.phonesList,"autocomplete-last-searched"),this.phonesMoreLi.style.display="",this.show();for(var i=[],o=s.split(/\s+/g),n=0;n<AUTOCOMPLETE_LIST.length;n++){var a=AUTOCOMPLETE_LIST[n],h=AUTOCOMPLETE_MAKERS[a[AUTOCOMPLETE_MAKERID]].toLowerCase(),l=h+" "+a[AUTOCOMPLETE_PHONE_NAME].toLowerCase(),r=h+" "+a[AUTOCOMPLETE_SEARCH_STR].toLowerCase();if((t(o,l)||t(o,r,!0))&&i.push(this.makePhone(a)),i.length>=AUTOCOMPLETE_MAX_LINES)break}this.setList(this.phonesList,i)}}else this.showRecentPhones()},Autocomplete.prototype.searchNewsAndReviews=function(){if(this.full){this.setList(this.newsList,[]),this.setList(this.reviewsList,[]);var e=this,t=this.field.value,s=NEWS_REVIEWS_URL+"?sSearch="+encodeURIComponent(t);t.length<AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH||(clearTimeout(this.newsReviewsTimeout),this.newsReviewsTimeout=setTimeout(function(){t.length>=1&&$gsm.xhr("GET",s,function(t){0!=e.field.value.length&&($gsm.addClass(e.div,"autocomplete-large"),$gsm.removeClass(e.div,"autocomplete-small"),t.news.splice(AUTOCOMPLETE_MAX_LINES),t.reviews.splice(AUTOCOMPLETE_MAX_LINES),e.setList(e.newsList,t.news),e.setList(e.reviewsList,t.reviews))})},AUTOCOMPLETE_NEWS_REVIEWS_TIMEOUT))}},Autocomplete.prototype.showRecentPhones=function(){this.loadRecentPhones();for(var e=[],t=0;t<Math.min(AUTOCOMPLETE_RECENT.length,AUTOCOMPLETE_MAX_LINES);t++)e.push(this.makePhone(AUTOCOMPLETE_RECENT[t]));0!=e.length&&(this.setList(this.phonesList,e),this.phoneLabel.innerHTML="Last visited",$gsm.addClass(this.phonesList,"autocomplete-last-searched"),$gsm.removeClass(this.div,"autocomplete-large"),$gsm.addClass(this.div,"autocomplete-small"),this.phonesMoreLi.style.display="none",this.show())},Autocomplete.prototype.hide=function(){$gsm.addClass(this.div,"autocomplete-hide"),this.searchButtons&&(this.searchButtons.style.display="none"),!this.position&&this.quickSearchButton&&(this.quickSearchButton.style.display="")},Autocomplete.prototype.show=function(){$gsm.removeClass(this.div,"autocomplete-hide"),this.searchButtons&&(this.searchButtons.style.display="initial"),!this.position&&this.quickSearchButton&&(this.quickSearchButton.style.display="none")};